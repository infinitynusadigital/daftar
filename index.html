<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Form Pendaftaran Internet - Bnetfit Business</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  body { background: linear-gradient(180deg,#071018 0%,#0b0f14 100%); color:#e6eef6; }
  .card { background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); border-radius:16px; padding:20px; max-width:720px; margin:40px auto; }
  label{ font-weight:600; }
</style>
</head>
<body>
  <div class="card">
    <h1 class="text-2xl font-bold text-center text-orange-400 mb-4">Form Pendaftaran Internet â€” Bnetfit Business</h1>

    <form id="bnetfitForm" method="POST" action="https://formsubmit.co/irfann.sugianto@gmail.com" enctype="multipart/form-data" target="hidden_iframe">
      <input type="hidden" name="_subject" value="Pendaftaran Baru - Bnetfit Business" />
      <input type="hidden" name="_template" value="table" />
      <input type="hidden" name="_captcha" value="false" />

      <div class="mb-3">
        <label>Nama (Usaha)</label>
        <input name="Nama_Usaha" required class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700" />
      </div>

      <div class="mb-3">
        <label>Alamat Instalasi</label>
        <textarea name="Alamat" required class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700"></textarea>
      </div>

      <div class="mb-3">
        <label>No Telp / WA</label>
        <input name="No_Telp_WA" required class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700" />
      </div>

      <div class="mb-3">
        <label>No Alternatif</label>
        <input name="No_Alternatif" class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700" />
      </div>

      <div class="mb-3">
        <label>Email</label>
        <input type="email" name="Email" required class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700" />
      </div>

      <div class="mb-3">
        <label>Kapasitas Paket</label>
        <select name="Kapasitas" required class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700 text-orange-400">
          <option value="">Pilih paket</option>
          <option>10 Mbps</option>
          <option>20 Mbps</option>
          <option>50 Mbps</option>
          <option>100 Mbps</option>
        </select>
      </div>

      <div class="mb-3">
        <label>Share Lokasi (Link Google Maps)</label>
        <input type="url" name="Share_lokasi" class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700" />
      </div>

      <div class="mb-3">
        <label>Instalasi</label>
        <select name="Instalasi" class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700">
          <option value="Disesuaikan">Disesuaikan</option>
          <option value="Biaya Standar">Biaya Standar</option>
        </select>
      </div>

      <div class="mb-4">
        <label>Upload Foto KTP (JPG/PNG/PDF, max 6MB)</label>
        <input type="file" id="FotoKTP" name="FotoKTP" accept="image/*,application/pdf" required class="w-full mt-1 p-2 rounded bg-[#0f1720] border border-slate-700" />
      </div>

      <div>
        <button type="submit" id="submitBtn" class="w-full py-2 rounded bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold">Kirim Pendaftaran</button>
      </div>
    </form>

    <iframe name="hidden_iframe" style="display:none;"></iframe>

  </div>

<script>
document.getElementById('bnetfitForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const form = e.target;
  const fileEl = document.getElementById('FotoKTP');
  const file = fileEl.files[0];

  // formsubmit post via hidden iframe (email + attachment)
  form.submit();

  // Prepare payload for Apps Script (base64)
  const googleScriptURL = "https://script.google.com/macros/s/AKfycbzAnKyI0xCSzhEPuFI4b9rWCwvSw8sTio8SH-wZ-ih8FckAWN1krecPmh6_Ij5fqHfs3A/exec"; // <-- GANTI
  const maxSize = 6 * 1024 * 1024; // 6MB
  if(file && file.size > maxSize){
    Swal.fire({icon:'error', title:'File terlalu besar', text: 'Max 6 MB untuk file KTP.'});
    return;
  }

  let ktp_b64 = "";
  if(file){
    ktp_b64 = await new Promise((res, rej) => {
      const reader = new FileReader();
      reader.onload = () => res(reader.result.split(',')[1]);
      reader.onerror = () => rej('Gagal baca file');
      reader.readAsDataURL(file);
    });
  }

  const fd = new FormData(form);
  // build payload object (exclude file)
  const payload = {};
  fd.forEach((v,k) => {
    if(k !== 'FotoKTP') payload[k] = v;
  });
  if(file){
    payload.ktp_base64 = ktp_b64;
    payload.ktp_name = file.name;
    payload.ktp_type = file.type || 'image/jpeg';
  }

  try {
    const res = await fetch(googleScriptURL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const j = await res.json();
    if(j.status === 'success'){
      Swal.fire({icon:'success', title:'Pendaftaran Berhasil', text:'Data dan KTP sudah diterima.'});
      form.reset();
    } else {
      throw new Error(j.message || 'Unknown error');
    }
  } catch(err){
    console.error(err);
    Swal.fire({icon:'error', title:'Gagal mengirim', text: String(err)});
  }
});
</script>

</body>
</html>
