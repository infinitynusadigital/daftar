<!--
File: index.html
Contains: responsive form, automatic dark mode, i18n (id/en), PWA registration, form POST to Apps Script endpoint.

Other files included below in this single document:
- manifest.json
- service-worker.js
- apps-script Code.gs (Google Apps Script server-side handler)

Instructions for deployment are at the bottom of this document.
-->

<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title data-i18n="title">Form Registrasi Internet</title>

  <meta name="description" content="Form registrasi pelanggan internet cepat dan stabil." />
  <meta name="theme-color" content="#2563eb" />

  <!-- PWA manifest -->
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icons/icon-192.png">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --bg: linear-gradient(135deg,#e0f2fe 0%,#f8fafc 100%);
      --text: #1e293b;
      --border: #e2e8f0;
    }

    /* Dark mode overrides */
    @media (prefers-color-scheme: dark) {
      :root{
        --bg: linear-gradient(135deg,#0f172a 0%, #071027 100%);
        --text: #e6eef8;
        --border: #0b1220;
      }
      body { background: var(--bg); }
      .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); box-shadow: 0 6px 24px rgba(2,6,23,0.6); }
      input, textarea, select { background: rgba(255,255,255,0.02); border:1px solid #112233; color:var(--text); }
    }

    /* Basic layout */
    body{ font-family:'Inter',sans-serif; background:var(--bg); margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; color:var(--text)}
    .container{ width:100%; max-width:760px }
    .card{ background:#fff; border-radius:16px; padding:28px; box-shadow:0 6px 24px rgba(0,0,0,0.07); transition:all .3s }
    .row{ display:flex; gap:12px; flex-wrap:wrap }
    .row .col{ flex:1; min-width:100% }
    @media(min-width:640px){ .row .col{ min-width:calc(50% - 6px) } }
    h1{ font-size:20px; margin:0 0 8px }
    p{ margin:0 0 16px; color:#64748b }
    label{ display:block; margin:10px 0 6px; font-weight:600 }
    input,textarea,select{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); font-size:14px }
    input:focus,textarea:focus,select:focus{ outline:none; box-shadow:0 0 0 3px rgba(37,99,235,0.12); border-color:var(--primary) }
    .price-box{ display:none; margin-top:8px; padding:10px 12px; border-radius:8px; background:#f9fafb; border:1px dashed #cbd5e1; font-weight:600 }
    .actions{ display:flex; gap:12px; align-items:center; justify-content:center; margin-top:18px }
    button{ background:var(--primary); color:#fff; border:none; padding:12px 18px; border-radius:10px; cursor:pointer; font-weight:700 }
    button[disabled]{ opacity:.6; cursor:not-allowed }
    .msg{ display:none; padding:10px 12px; border-radius:8px; margin-top:12px; text-align:center }
    .msg.ok{ background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0 }
    .msg.err{ background:#fef2f2; color:#991b1b; border:1px solid #fecaca }

    .topbar{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px }
    .lang-toggle{ display:flex; gap:8px }
    .chip{ background:transparent; border:1px solid var(--border); padding:6px 8px; border-radius:8px; cursor:pointer }
    .chip.active{ background:var(--primary); color:#fff; border-color:var(--primary) }

    footer{ text-align:center; color:#94a3b8; font-size:13px; margin-top:12px }

    /* small helpers */
    .helper{ font-size:13px; color:#475569 }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="topbar">
        <div>
          <h1 data-i18n="heading">‚úÖ Form Registrasi Pelanggan</h1>
          <p data-i18n="sub">Isi data di bawah ini untuk berlangganan layanan internet.</p>
        </div>
        <div class="lang-toggle" role="tablist" aria-label="Pilih Bahasa">
          <button class="chip active" id="lang-id" data-lang="id">ID</button>
          <button class="chip" id="lang-en" data-lang="en">EN</button>
        </div>
      </div>

      <!-- hidden iframe for Apps Script response (same as before) -->
      <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

      <!-- Set the action to your deployed Google Apps Script web app URL -->
      <form id="regForm" action="https://script.google.com/macros/s/AKfycbysv4_c7qSNK6f6dNhWz16ZtKwYR4XuIQBsNQTpkpL_YtZEwMmvMprGrbm0BKqvpSA2/exec" method="POST" target="hidden_iframe" novalidate>
        <input type="text" name="hp" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px;opacity:0;height:0;width:0;" />

        <label for="nama_usaha" data-i18n="label_name">‚úÖ Nama (Usaha)</label>
        <input id="nama_usaha" name="nama_usaha" type="text" placeholder="Nama Usaha atau Pribadi" required>

        <label for="alamat_instalasi" data-i18n="label_address">‚úÖ Alamat Instalasi</label>
        <textarea id="alamat_instalasi" name="alamat_instalasi" rows="3" placeholder="Nama jalan, RT/RW, Kelurahan, Kecamatan, Kota" required></textarea>

        <div class="row">
          <div class="col">
            <label for="telp" data-i18n="label_phone">‚úÖ No Telp / WA</label>
            <input id="telp" name="telp" type="tel" placeholder="+62 8xx xxx xxxx" required>
            <div class="helper" id="telHint">Minimal 9 digit.</div>
          </div>
          <div class="col">
            <label for="email" data-i18n="label_email">‚úÖ Email</label>
            <input id="email" name="email" type="email" placeholder="nama@gmail.com" required>
          </div>
        </div>

        <label for="kapasitas" data-i18n="label_package">üî• Paket Internet</label>
        <select id="kapasitas" name="kapasitas" required>
          <option value="" disabled selected data-i18n="choose">Pilih paket...</option>
          <option value="5 Mbps">5 Mbps</option>
          <option value="8 Mbps">8 Mbps</option>
          <option value="10 Mbps">10 Mbps</option>
          <option value="20 Mbps">20 Mbps</option>
          <option value="30 Mbps">30 Mbps</option>
          <option value="50 Mbps">50 Mbps</option>
        </select>

        <div id="hargaBox" class="price-box"></div>

        <label for="share_lokasi" data-i18n="label_map">Share Lokasi (Google Maps)</label>
        <input id="share_lokasi" name="share_lokasi" type="url" placeholder="Link Google Maps (opsional)">

        <label for="instalasi" data-i18n="label_install">Jenis Instalasi</label>
        <input id="instalasi" name="instalasi" type="text" placeholder="Baru / Upgrade / Perbaikan">

        <div class="actions">
          <button id="submitBtn" type="submit"><span id="btnText" data-i18n="send">Kirim Data</span><span id="btnLoader" style="display:none"> ‚è≥</span></button>
          <span id="spinner" style="display:none">‚è≥ <span data-i18n="sending">Mengirim...</span></span>
        </div>

        <div id="okMsg" class="msg ok" data-i18n="ok">‚úÖ Terima kasih! Data Anda sudah kami terima.</div>
        <div id="errMsg" class="msg err" data-i18n="err">‚ùå Maaf, terjadi kesalahan. Coba lagi ya.</div>
      </form>

      <footer>¬© <span id="year">2025</span> covernet | <span data-i18n="note">Data otomatis tersimpan ke Sistem Kami</span></footer>
    </div>
  </div>

  <script>
    /* ---------- Simple i18n dictionary ---------- */
    const i18n = {
      id: {
        title: 'Form Registrasi Internet',
        heading: '‚úÖ Form Registrasi Pelanggan',
        sub: 'Isi data di bawah ini untuk berlangganan layanan internet.',
        label_name: '‚úÖ Nama (Usaha)',
        label_address: '‚úÖ Alamat Instalasi',
        label_phone: '‚úÖ No Telp / WA',
        label_email: '‚úÖ Email',
        label_package: 'üî• Paket Internet',
        choose: 'Pilih paket...',
        label_map: 'Share Lokasi (Google Maps)',
        label_install: 'Jenis Instalasi',
        send: 'Kirim Data',
        sending: 'Mengirim...',
        ok: '‚úÖ Terima kasih! Data Anda sudah kami terima.',
        err: '‚ùå Maaf, terjadi kesalahan. Coba lagi ya.',
        note: 'Data otomatis tersimpan ke Sistem Kami'
      },
      en: {
        title: 'Internet Registration Form',
        heading: '‚úÖ Customer Registration Form',
        sub: 'Fill the fields below to subscribe to our internet service.',
        label_name: '‚úÖ Name (Business / Personal)',
        label_address: '‚úÖ Installation Address',
        label_phone: '‚úÖ Phone / WA',
        label_email: '‚úÖ Email',
        label_package: 'üî• Internet Package',
        choose: 'Choose a package...',
        label_map: 'Share Location (Google Maps)',
        label_install: 'Installation Type',
        send: 'Send Data',
        sending: 'Sending...',
        ok: '‚úÖ Thank you! We received your data.',
        err: '‚ùå Sorry, something went wrong. Please try again.',
        note: 'Data automatically saved to our system'
      }
    };

    // Set default language based on browser or saved preference
    const langButtons = document.querySelectorAll('.chip');
    const savedLang = localStorage.getItem('site_lang') || (navigator.language && navigator.language.startsWith('en') ? 'en' : 'id');

    function applyLang(lang){
      document.documentElement.lang = (lang === 'en') ? 'en' : 'id';
      localStorage.setItem('site_lang', lang);
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if(i18n[lang] && i18n[lang][key]){
          el.textContent = i18n[lang][key];
        }
      });
      // update chips
      langButtons.forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
    }

    langButtons.forEach(btn => btn.addEventListener('click', () => applyLang(btn.dataset.lang)));
    applyLang(savedLang);

    /* ---------- Form logic (validation, price box, feedback) ---------- */
    const form = document.getElementById('regForm');
    const submitBtn = document.getElementById('submitBtn');
    const spinner = document.getElementById('spinner');
    const okMsg = document.getElementById('okMsg');
    const errMsg = document.getElementById('errMsg');
    const iframe = document.getElementById('hidden_iframe');
    const kapasitasSelect = document.getElementById('kapasitas');
    const hargaBox = document.getElementById('hargaBox');
    const btnText = document.getElementById('btnText');
    const btnLoader = document.getElementById('btnLoader');

    const hargaPaket = {
      "5 Mbps": "Rp80.000 / bulan",
      "8 Mbps": "Rp120.000 / bulan",
      "10 Mbps": "Rp150.000 / bulan",
      "20 Mbps": "Rp180.000 / bulan",
      "30 Mbps": "Rp250.000 / bulan",
      "50 Mbps": "Rp340.000 / bulan"
    };

    kapasitasSelect.addEventListener('change', () => {
      const paket = kapasitasSelect.value;
      if (hargaPaket[paket]) {
        hargaBox.textContent = `üí∞ Harga: ${hargaPaket[paket]}`;
        hargaBox.style.display = 'block';
      } else {
        hargaBox.style.display = 'none';
      }
    });

    // simple WA number sanitization
    const telp = document.getElementById('telp');
    telp.addEventListener('input', () => {
      telp.value = telp.value.replace(/[^\d+]/g, '');
    });

    let submitted = false;
    let submitTimeoutID = null;

    form.addEventListener('submit', function (e) {
      if (!form.checkValidity()) {
        e.preventDefault();
        form.reportValidity();
        return;
      }

      submitted = true;
      submitBtn.disabled = true;
      btnText.style.display = 'none';
      btnLoader.style.display = 'inline';
      spinner.style.display = 'inline';
      okMsg.style.display = 'none';
      errMsg.style.display = 'none';

      // fallback: if no response in 10s, show error (iframe load doesn't guarantee success)
      submitTimeoutID = setTimeout(() => {
        if (submitted) {
          spinner.style.display = 'none';
          submitBtn.disabled = false;
          btnText.style.display = '';
          btnLoader.style.display = 'none';
          okMsg.style.display = 'none';
          errMsg.style.display = 'block';
          submitted = false;
        }
      }, 10000);
    });

    // Listen for iframe load to consider submission successful
    iframe.addEventListener('load', function () {
      if (!submitted) return;
      clearTimeout(submitTimeoutID);
      submitBtn.disabled = false;
      spinner.style.display = 'none';
      btnText.style.display = '';
      btnLoader.style.display = 'none';
      okMsg.style.display = 'block';
      errMsg.style.display = 'none';
      hargaBox.style.display = 'none';
      form.reset();
      submitted = false;
    });

    /* ---------- Register service worker for PWA ---------- */
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(() => console.log('ServiceWorker registered'))
          .catch(err => console.warn('SW registration failed:', err));
      });
    }

    // Update year
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>


/* ===== manifest.json ===== */
{
  "name": "CoverNet - Registrasi",
  "short_name": "CoverNet",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#2563eb",
  "icons": [
    {"src":"/icons/icon-192.png","sizes":"192x192","type":"image/png"},
    {"src":"/icons/icon-512.png","sizes":"512x512","type":"image/png"}
  ]
}


/* ===== service-worker.js ===== */
// Minimal service worker: cache the shell and serve offline
const CACHE_NAME = 'covernet-v1';
const FILES_TO_CACHE = [
  '/',
  '/index.html',
  '/manifest.json',
  '/icons/icon-192.png',
  '/icons/icon-512.png'
];

self.addEventListener('install', (evt) => {
  evt.waitUntil(
    caches.open(CACHE_NAME).then(cache => cache.addAll(FILES_TO_CACHE))
  );
  self.skipWaiting();
});

self.addEventListener('activate', (evt) => {
  evt.waitUntil(
    caches.keys().then(keys => Promise.all(
      keys.map(k => { if (k !== CACHE_NAME) return caches.delete(k); })
    ))
  );
  self.clients.claim();
});

self.addEventListener('fetch', (evt) => {
  if (evt.request.method !== 'GET') return;
  evt.respondWith(
    caches.match(evt.request).then(res => res || fetch(evt.request).then(fetchRes => {
      return caches.open(CACHE_NAME).then(cache => { cache.put(evt.request, fetchRes.clone()); return fetchRes; });
    })).catch(() => caches.match('/'))
  );
});


/* ===== apps-script Code.gs ===== */
// Paste this to Google Apps Script editor (new project). Set the spreadsheetId, telegram token & chatId.

const SPREADSHEET_ID = 'REPLACE_WITH_YOUR_SPREADSHEET_ID';
const SHEET_NAME = 'Registrations';
const TELEGRAM_BOT_TOKEN = 'REPLACE_WITH_BOT_TOKEN';
const TELEGRAM_CHAT_ID = 'REPLACE_WITH_CHAT_ID';

function doGet(e) {
  return HtmlService.createHtmlOutput('Hello from Apps Script');
}

function doPost(e) {
  try {
    const params = e.parameter || {};
    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    let sheet = ss.getSheetByName(SHEET_NAME);
    if (!sheet) sheet = ss.insertSheet(SHEET_NAME);

    // Prepare row
    const now = new Date();
    const row = [
      now.toISOString(),
      params.nama_usaha || '',
      params.alamat_instalasi || '',
      params.telp || '',
      params.email || '',
      params.kapasitas || '',
      params.share_lokasi || '',
      params.instalasi || ''
    ];

    sheet.appendRow(row);

    // Send Telegram notification (basic)
    try {
      const text = `New registration:\nName: ${params.nama_usaha || '-'}\nPhone: ${params.telp || '-'}\nPackage: ${params.kapasitas || '-'}\nAddress: ${params.alamat_instalasi || '-'}\nEmail: ${params.email || '-'}\nTime: ${now.toLocaleString()}`;
      const tgUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
      const payload = { chat_id: TELEGRAM_CHAT_ID, text: text };
      const options = { method: 'post', payload: payload, muteHttpExceptions: true };
      UrlFetchApp.fetch(tgUrl, options);
    } catch (tgErr) {
      // ignore telegram errors but log
      console.error('Telegram error:', tgErr);
    }

    // Return simple HTML so iframe will 'load'
    return HtmlService.createHtmlOutput('<html><body>OK</body></html>');
  } catch (err) {
    console.error(err);
    return HtmlService.createHtmlOutput('<html><body>ERR</body></html>');
  }
}


/* ===== Deployment & Setup Instructions ===== */
/*
1) HOSTING / FILES
   - Put index.html, manifest.json, service-worker.js and two icons (/icons/icon-192.png and icon-512.png) on your webhost root.
   - Ensure service-worker.js is served from the same origin and root path.

2) GOOGLE APPS SCRIPT (collect to Google Sheets + Telegram)
   - Create a new Google Apps Script project (https://script.google.com).
   - Replace SPREADSHEET_ID, TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID in Code.gs.
   - Save, then Deploy > New deployment > Select 'Web app'.
     * Execute as: Me
     * Who has access: Anyone (or Anyone, even anonymous) ‚Äî choose depending on your needs.
   - Copy the Web app URL and paste it into the form `action` in index.html (replace REPLACE_WITH_YOUR_DEPLOYED_URL).

3) SPREADSHEET
   - Create a Google Sheet and copy its ID into SPREADSHEET_ID.
   - The script will create sheet named 'Registrations' automatically if missing.

4) TELEGRAM BOT (optional)
   - Create a bot with @BotFather and get the token.
   - To find a chat id: start a chat with your bot or add to group; use `https://api.telegram.org/bot<token>/getUpdates` to see chat id in updates, or use @userinfobot.

5) PWA / HTTPS
   - PWAs require HTTPS (except on localhost). Host on HTTPS so manifest and service worker work.

6) TESTING
   - Open the page, fill the form, and submit. If everything's configured, Apps Script will append a row and send Telegram message.

7) PRIVACY & SECURITY
   - The Apps Script above returns a basic HTML response to the iframe; for production you may want to add spam protection (honeypot field already included), CAPTCHA, rate limits, and input sanitization.

*/
